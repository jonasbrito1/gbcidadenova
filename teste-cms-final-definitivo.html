<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ CMS Final - Sistema Gracie Barra</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 70vh;
        }
        .left-panel {
            padding: 2rem;
            border-right: 1px solid #e9ecef;
            background: #f8f9fa;
        }
        .right-panel {
            padding: 0;
            background: white;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h3 {
            color: #343a40;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); color: #212529; }
        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .logs {
            background: #2d3748;
            color: #a0aec0;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .logs::-webkit-scrollbar { width: 8px; }
        .logs::-webkit-scrollbar-track { background: #1a202c; }
        .logs::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
        }
        .input-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #007bff;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        @media (max-width: 768px) {
            .content { grid-template-columns: 1fr; }
            .left-panel { border-right: none; border-bottom: 1px solid #e9ecef; }
            .header h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Sistema CMS Final</h1>
            <p>Gracie Barra - Teste de Valida√ß√£o Completa</p>
        </div>

        <div class="content">
            <div class="left-panel">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="testCount">0</div>
                        <div class="stat-label">Testes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successCount">0</div>
                        <div class="stat-label">Sucessos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="errorCount">0</div>
                        <div class="stat-label">Erros</div>
                    </div>
                </div>

                <div class="test-section">
                    <h3>üîß Controles do Sistema</h3>
                    <button class="btn" onclick="executarTodosOsTestes()" id="btnTeste">
                        Executar Bateria Completa
                    </button>
                    <button class="btn btn-warning" onclick="limparLogs()">
                        Limpar Logs
                    </button>
                    <button class="btn btn-success" onclick="abrirCMS()">
                        Abrir Interface CMS
                    </button>
                </div>

                <div class="test-section">
                    <h3>üìù Teste Manual</h3>
                    <div class="input-group">
                        <input type="text" id="textoPersonalizado" placeholder="Digite um texto para testar...">
                    </div>
                    <button class="btn" onclick="testarTextoPersonalizado()">
                        Atualizar T√≠tulo Principal
                    </button>
                    <div id="resultadoManual"></div>
                </div>

                <div class="test-section">
                    <h3>üìä Logs do Sistema</h3>
                    <div class="logs" id="logsContainer"></div>
                </div>
            </div>

            <div class="right-panel" id="cmsPanel">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f9fa; color: #6c757d; font-size: 1.2rem;">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üñ•Ô∏è</div>
                        <p>Clique em "Abrir Interface CMS" para carregar o sistema</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3011/api/cms';
        const CMS_URL = 'http://localhost:3010/app/cms';

        let testCount = 0;
        let successCount = 0;
        let errorCount = 0;

        function updateStats() {
            document.getElementById('testCount').textContent = testCount;
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('errorCount').textContent = errorCount;
        }

        function log(message, type = 'info') {
            const container = document.getElementById('logsContainer');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                success: '#48bb78',
                error: '#f56565',
                warning: '#ed8936',
                info: '#4299e1'
            };

            container.innerHTML += `<div style="color: ${colors[type]}; margin: 3px 0;">
                [${timestamp}] ${message}
            </div>`;
            container.scrollTop = container.scrollHeight;

            console.log(`[${timestamp}] ${message}`);
        }

        function limparLogs() {
            document.getElementById('logsContainer').innerHTML = '';
            testCount = 0;
            successCount = 0;
            errorCount = 0;
            updateStats();
            log('üßπ Sistema reiniciado', 'info');
        }

        function mostrarResultado(elementId, tipo, mensagem) {
            const elemento = document.getElementById(elementId);
            if (elemento) {
                elemento.innerHTML = `<div class="status ${tipo}">${mensagem}</div>`;
            }
        }

        async function testarAPI(endpoint, metodo = 'GET', dados = null) {
            testCount++;
            updateStats();

            try {
                const opcoes = {
                    method: metodo,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (dados) {
                    opcoes.body = JSON.stringify(dados);
                }

                const response = await fetch(`${API_BASE}${endpoint}`, opcoes);
                const data = await response.json();

                if (response.ok && data.success) {
                    successCount++;
                    updateStats();
                    return { sucesso: true, data };
                } else {
                    errorCount++;
                    updateStats();
                    return { sucesso: false, erro: data.error || 'Erro desconhecido' };
                }
            } catch (error) {
                errorCount++;
                updateStats();
                return { sucesso: false, erro: error.message };
            }
        }

        async function executarTodosOsTestes() {
            const btnTeste = document.getElementById('btnTeste');
            btnTeste.disabled = true;
            btnTeste.textContent = '‚è≥ Testando...';

            log('üöÄ Iniciando bateria completa de testes do CMS', 'info');

            try {
                // Teste 1: Verificar se√ß√µes
                log('üìã [1/5] Testando carregamento de se√ß√µes...', 'info');
                const teste1 = await testarAPI('/secoes');
                if (teste1.sucesso) {
                    log(`‚úÖ [1/5] Se√ß√µes carregadas: ${teste1.data.data.length} encontradas`, 'success');
                } else {
                    log(`‚ùå [1/5] Falha: ${teste1.erro}`, 'error');
                }

                // Teste 2: Carregar se√ß√£o espec√≠fica
                log('üìñ [2/5] Testando carregamento da se√ß√£o Hero...', 'info');
                const teste2 = await testarAPI('/secoes/1');
                if (teste2.sucesso) {
                    log(`‚úÖ [2/5] Se√ß√£o Hero: ${teste2.data.data.conteudos.length} conte√∫dos`, 'success');
                } else {
                    log(`‚ùå [2/5] Falha no carregamento da se√ß√£o`, 'error');
                }

                // Teste 3: Atualizar conte√∫do
                const textoTeste = `üéØ Teste Autom√°tico ${new Date().toLocaleTimeString()}`;
                log(`üìù [3/5] Testando atualiza√ß√£o de conte√∫do: "${textoTeste}"`, 'info');
                const teste3 = await testarAPI('/conteudos/1', 'PUT', { valor: textoTeste });
                if (teste3.sucesso) {
                    log(`‚úÖ [3/5] Conte√∫do atualizado com sucesso`, 'success');
                } else {
                    log(`‚ùå [3/5] Falha na atualiza√ß√£o: ${teste3.erro}`, 'error');
                }

                // Teste 4: Verificar persist√™ncia
                log('üîç [4/5] Verificando persist√™ncia da mudan√ßa...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
                const teste4 = await testarAPI('/secoes/1');
                if (teste4.sucesso) {
                    const conteudo = teste4.data.data.conteudos.find(c => c.id === 1);
                    if (conteudo && conteudo.valor === textoTeste) {
                        log(`‚úÖ [4/5] Persist√™ncia confirmada: "${conteudo.valor}"`, 'success');
                    } else {
                        log(`‚ö†Ô∏è [4/5] Problema na persist√™ncia. Valor: "${conteudo.valor}"`, 'warning');
                    }
                }

                // Teste 5: Verificar acesso a imagens
                log('üñºÔ∏è [5/5] Testando acesso a imagens...', 'info');
                try {
                    const imgResponse = await fetch('http://localhost:3011/uploads/cms/cms-1759102015813-171141797.jpg');
                    if (imgResponse.ok) {
                        log(`‚úÖ [5/5] Imagens acess√≠veis (${imgResponse.status})`, 'success');
                    } else {
                        log(`‚ö†Ô∏è [5/5] Problema com imagens (${imgResponse.status})`, 'warning');
                    }
                } catch (error) {
                    log(`‚ùå [5/5] Erro no acesso a imagens: ${error.message}`, 'error');
                }

                // Resultado final
                const porcentagemSucesso = Math.round((successCount / testCount) * 100);
                log(`üéâ Bateria de testes conclu√≠da: ${successCount}/${testCount} sucessos (${porcentagemSucesso}%)`,
                    porcentagemSucesso >= 80 ? 'success' : 'warning');

                if (porcentagemSucesso >= 80) {
                    log('üöÄ SISTEMA CMS EST√Å FUNCIONANDO CORRETAMENTE!', 'success');
                } else {
                    log('‚ö†Ô∏è Sistema apresenta problemas, verificar logs', 'warning');
                }

            } catch (error) {
                log(`üí• Erro cr√≠tico nos testes: ${error.message}`, 'error');
            } finally {
                btnTeste.disabled = false;
                btnTeste.textContent = 'Executar Bateria Completa';
            }
        }

        async function testarTextoPersonalizado() {
            const texto = document.getElementById('textoPersonalizado').value.trim();
            if (!texto) {
                alert('Digite um texto primeiro!');
                return;
            }

            log(`üìù Teste manual: "${texto}"`, 'info');

            const resultado = await testarAPI('/conteudos/1', 'PUT', { valor: texto });
            if (resultado.sucesso) {
                log(`‚úÖ Texto manual atualizado: "${texto}"`, 'success');
                mostrarResultado('resultadoManual', 'success', '‚úÖ Texto atualizado com sucesso!');
            } else {
                log(`‚ùå Falha no teste manual: ${resultado.erro}`, 'error');
                mostrarResultado('resultadoManual', 'error', `‚ùå Erro: ${resultado.erro}`);
            }
        }

        function abrirCMS() {
            log('üñ•Ô∏è Carregando interface CMS...', 'info');
            const panel = document.getElementById('cmsPanel');
            panel.innerHTML = `<iframe src="${CMS_URL}" title="Sistema CMS"></iframe>`;
        }

        // Inicializa√ß√£o
        window.onload = function() {
            log('üîß Sistema de teste carregado e pronto', 'info');
            document.getElementById('textoPersonalizado').value = `Teste Manual ${new Date().toLocaleTimeString()}`;
            updateStats();
        };
    </script>
</body>
</html>